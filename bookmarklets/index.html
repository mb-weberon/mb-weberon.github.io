<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini Tool Suite</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: #f8f9fa; padding: 20px; }
        .box { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; border: 1px solid #ddd; width: 100%; max-width: 400px; }
        .btn { display: inline-block; background: #1a73e8; color: white; padding: 14px 28px; border-radius: 50px; text-decoration: none; font-weight: bold; cursor: move; box-shadow: 0 4px 10px rgba(26,115,232,0.2); transition: 0.2s; }
        .btn:hover { background: #174ea6; transform: translateY(-2px); }
        h2 { color: #1f1f1f; margin: 0; }
        h3 { font-size: 16px; color: #444; margin-bottom: 15px; }
        p { color: #666; margin-bottom: 30px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="box">
        <h2>Gemini Tool Suite</h2>
        <p>Drag the buttons below to your Bookmarks Bar.</p>
        
            <div class="tool-item">
                <h3>Export Gemini Chat</h3>
                <a class="btn" href="javascript:(function(){    function findElementsDeep(root, selector) {        let found = Array.from(root.querySelectorAll(selector));        root.querySelectorAll('*').forEach(el => {            if (el.shadowRoot) found = found.concat(findElementsDeep(el.shadowRoot, selector));        });        return found;    }    const userPromptsRaw = findElementsDeep(document, '.user-query-content, [data-test-id=&quot;user-query&quot;], .query-text');    const geminiResponsesRaw = findElementsDeep(document, 'message-content, .model-response-text');    function getUniqueItems(nodes) {        const seen = new Set();        const unique = [];        nodes.forEach(node => {            const text = node.innerText.trim().split('Export to Sheets')[0];            if (text && !seen.has(text)) {                seen.add(text);                /* Clone the node so we can modify it without breaking the live page */                const clone = node.cloneNode(true);                /* SCRUB: Remove empty Angular buttons and noise */                clone.querySelectorAll('button, .button, .ng-star-inserted').forEach(btn => {                    if(!btn.innerText.trim()) btn.remove();                });                unique.push(clone);            }        });        return unique;    }    const userPrompts = getUniqueItems(userPromptsRaw);    const geminiResponses = getUniqueItems(geminiResponsesRaw);    let finalHtml = `<!DOCTYPE html><html><head><meta charset=&quot;UTF-8&quot;>    <title>Gemini Clean Export</title>    <link href=&quot;https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&family=Roboto+Mono&display=swap&quot; rel=&quot;stylesheet&quot;>    <style>        :root { --bg-main: #ffffff; --bg-user: #f0f4f9; --text-main: #1f1f1f; --text-sub: #70757a; --code-header: #f8f9fa; --border: #dee2e6; --spark-blue: #4285f4; }        body { font-family: 'Google Sans', sans-serif; background: var(--bg-main); color: var(--text-main); margin: 0; padding: 0; }        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }        .user-row { display: flex; justify-content: flex-end; margin-bottom: 32px; }        .user-bubble { background: var(--bg-user); padding: 12px 24px; border-radius: 24px; max-width: 85%; font-size: 1rem; line-height: 1.5; }        .model-row { display: flex; gap: 16px; margin-bottom: 48px; }        .spark-icon { width: 24px; height: 24px; flex-shrink: 0; margin-top: 4px; color: var(--spark-blue); }        .model-content { flex: 1; font-size: 1rem; line-height: 1.6; }        .code-block-wrapper { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin: 16px 0; background: #fdfdfd; }        .code-header { background: var(--code-header); padding: 8px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); font-size: 0.75rem; color: var(--text-sub); }        .copy-btn { cursor: pointer; color: var(--spark-blue); font-weight: 500; }        pre { margin: 0; padding: 16px; overflow-x: auto; background: #f8f9fa; }        code { font-family: 'Roboto Mono', monospace; font-size: 0.9rem; }        .footer-icons { display: flex; gap: 16px; margin-top: 16px; color: var(--text-sub); opacity: 0.6; }        .footer-icons svg { width: 18px; height: 18px; }        /* Prevent layout breaking from original CSS classes */        .model-content * { max-width: 100%; }        button, .button { display: none !important; } /* Final safety nuking of orphaned buttons */    </style></head><body><div class=&quot;container&quot;>%60;    const sparkSvg = %60<svg class=&quot;spark-icon&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;currentColor&quot;><path d=&quot;M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z&quot;/></svg>%60;    const footerSvgs = %60<div class=&quot;footer-icons&quot;><svg viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot;><path d=&quot;M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3&quot;/></svg><svg viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot;><path d=&quot;M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3&quot;/></svg><svg viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot;><circle cx=&quot;18&quot; cy=&quot;5&quot; r=&quot;3&quot;/><circle cx=&quot;6&quot; cy=&quot;12&quot; r=&quot;3&quot;/><circle cx=&quot;18&quot; cy=&quot;19&quot; r=&quot;3&quot;/><line x1=&quot;8.59&quot; y1=&quot;13.51&quot; x2=&quot;15.42&quot; y2=&quot;17.49&quot;/><line x1=&quot;15.41&quot; y1=&quot;6.51&quot; x2=&quot;8.59&quot; y2=&quot;10.49&quot;/></svg></div>%60;    const length = Math.max(userPrompts.length, geminiResponses.length);    for (let i = 0; i < length; i++) {        if (userPrompts[i]) {            finalHtml += %60<div class=&quot;user-row&quot;><div class=&quot;user-bubble&quot;>${userPrompts[i].innerHTML}</div></div>%60;        }        if (geminiResponses[i]) {            let content = geminiResponses[i].innerHTML;            /* Wrap code blocks */            content = content.replace(/<pre[^>]*><code[^>]*>([\s\S]*?)<\/code><\/pre>/g, function(match, code) {                return %60<div class=&quot;code-block-wrapper&quot;><div class=&quot;code-header&quot;><span>Code</span><span class=&quot;copy-btn&quot;>Copy code</span></div><pre><code>${code}</code></pre></div>%60;            });            finalHtml += %60<div class=&quot;model-row&quot;>${sparkSvg}<div class=&quot;model-content&quot;>${content}${footerSvgs}</div></div>%60;        }    }    finalHtml += %60</div><script>        document.querySelectorAll('.copy-btn').forEach(btn => {            btn.onclick = function() {                const code = this.closest('.code-block-wrapper').querySelector('code').innerText;                navigator.clipboard.writeText(code);                this.innerText = 'Copied!';                setTimeout(() => { this.innerText = 'Copy code'; }, 2000);            };        });    <\/script></body></html>%60;    const blob = new Blob([finalHtml], {type: 'text/html'});    const a = document.createElement('a');    a.href = URL.createObjectURL(blob);    a.download = 'gemini_clean_export.html';    a.click();})();">Export Gemini Chat</a>
            </div>
        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div class="tool-item">
                <h3>Edit Gemini Chat</h3>
                <a class="btn" href="javascript:(function(){
    const sourceHTML = document.documentElement.outerHTML;
    
    /* Improved Scroll Sync with Lock Mechanism */
    const scrollSyncScript = `
        let isSyncing = false;
        window.onscroll = () => {
            if (!isSyncing) {
                window.parent.postMessage({
                    type: 'scroll', 
                    top: window.scrollY, 
                    left: window.scrollX, 
                    origin: window.name
                }, '*');
            }
        };
        window.addEventListener('message', (e) => {
            if (e.data.type === 'scroll' && e.data.origin !== window.name) {
                isSyncing = true;
                window.scrollTo(e.data.left, e.data.top);
                /* Brief timeout to allow the browser to complete the scroll before unlocking */
                setTimeout(() => { isSyncing = false; }, 50);
            }
        });
    `;

    document.head.innerHTML = '<title>Gemini Mirror Editor (Fixed)</title>';
    document.body.innerHTML = `
        <div id=&quot;editor-header&quot; style=&quot;position:fixed; top:0; left:0; width:100%; height:60px; background:#1a73e8; color:white; display:flex; align-items:center; justify-content:space-between; padding:0 30px; z-index:9999; font-family:sans-serif; box-sizing:border-box;&quot;>
            <div style=&quot;font-weight:bold; font-size:18px;&quot;>Gemini Mirror Editor</div>
            <button id=&quot;save-btn&quot; style=&quot;background:white; color:#1a73e8; border:none; padding:8px 20px; border-radius:4px; font-weight:bold; cursor:pointer;&quot;>Download Edited Version</button>
        </div>
        <div style=&quot;display:flex; width:100vw; height:calc(100vh - 60px); margin-top:60px; overflow:hidden; background:#f0f2f5;&quot;>
            <iframe id=&quot;left-frame&quot; name=&quot;left&quot; style=&quot;flex:1; border:none; border-right:2px solid #ddd; background:white;&quot;></iframe>
            <iframe id=&quot;right-frame&quot; name=&quot;right&quot; style=&quot;flex:1; border:none; background:white;&quot;></iframe>
        </div>
    `;

    const leftFrame = document.getElementById('left-frame');
    const rightFrame = document.getElementById('right-frame');

    /* Reference Pane */
    leftFrame.srcdoc = sourceHTML + `<script>${scrollSyncScript}<\/script>`;

    /* Editor Pane */
    const parser = new DOMParser();
    const doc = parser.parseFromString(sourceHTML, 'text/html');
    doc.querySelectorAll('.user-bubble, .model-content').forEach(el => {
        el.setAttribute('contenteditable', 'true');
        el.style.outline = '2px dashed #4285f4';
        el.style.outlineOffset = '5px';
    });

    rightFrame.srcdoc = doc.documentElement.outerHTML + `<script>${scrollSyncScript}<\/script>`;

    window.addEventListener('message', (e) => {
        if(e.data.type === 'scroll') {
            const target = e.data.origin === 'left' ? rightFrame : leftFrame;
            target.contentWindow.postMessage(e.data, '*');
        }
    });

    document.getElementById('save-btn').onclick = () => {
        const editedDoc = rightFrame.contentDocument.cloneNode(true);
        editedDoc.querySelectorAll('[contenteditable]').forEach(el => {
            el.removeAttribute('contenteditable');
            el.style.outline = '';
            el.style.outlineOffset = '';
        });
        editedDoc.querySelectorAll('script').forEach(s => {
            if(s.innerText.includes('postMessage')) s.remove();
        });
        const finalBlob = new Blob([editedDoc.documentElement.outerHTML], {type: 'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(finalBlob);
        a.download = 'Gemini_Edited.html';
        a.click();
    };
})();">Edit Gemini Chat</a>
            </div>
        
    </div>
</body>
</html>