<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMB Visual Scanner</title>
    <style>
        :root { --accent: #00ff00; }
        body { font-family: system-ui, sans-serif; margin: 0; background: #121212; color: white; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Layout Containers */
        #camera-section { position: relative; flex: 1; background: #000; overflow: hidden; }
        #output-section { padding: 15px; background: #1e1e1e; border-top: 1px solid #333; z-index: 20; }
        
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* Viewfinder */
        #viewfinder {
            position: absolute; top: 50%; left: 5%; width: 90%; height: 50px;
            border: 2px solid var(--accent); transform: translateY(-50%);
            box-shadow: 0 0 0 2000px rgba(0,0,0,0.6); pointer-events: none;
        }

        /* FADT Text Display */
        #fadt-display { 
            background: #000; padding: 12px; border-radius: 6px; 
            font-family: 'Courier New', monospace; font-size: 1rem;
            word-break: break-all; min-height: 2.5em; border: 1px solid #444;
            color: var(--accent); margin-bottom: 10px;
        }

        /* Buttons */
        .btn-group { display: flex; gap: 10px; justify-content: center; }
        button { 
            flex: 1; padding: 12px; font-size: 0.9rem; font-weight: bold;
            border-radius: 6px; border: none; cursor: pointer;
        }
        #copy-btn { background: #007bff; color: white; }
        #reset-btn { background: #444; color: white; }

        /* Landscape Orientation Fix */
        @media (orientation: landscape) {
            body { flex-direction: row; }
            #camera-section { flex: 3; }
            #output-section { flex: 2; border-top: none; border-left: 1px solid #333; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; }
            #viewfinder { height: 40px; }
        }
    </style>
</head>
<body>

    <div id="camera-section">
        <video id="video" autoplay playsinline></video>
        <div id="viewfinder"></div>
    </div>

    <div id="output-section">
        <div id="status">Align barcode in green box...</div>
        <div id="fadt-display">Searching...</div>
        <div class="btn-group">
            <button id="copy-btn" onclick="copyString()">Copy String</button>
            <button id="reset-btn" onclick="resetScanner()">Clear / Scan Again</button>
        </div>
    </div>

    <canvas id="procCanvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('procCanvas');
    const display = document.getElementById('fadt-display');
    const statusText = document.getElementById('status');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    let isLocked = false;

    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment", width: { ideal: 1280 } } 
            });
            video.src
